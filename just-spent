#!/bin/bash

# Just Spent - Unified Project Runner
# This script delegates to platform-specific scripts in scripts/ directory.

set -e

# Colors
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
RED='\033[0;31m'
NC='\033[0m'

show_help() {
    echo -e "${GREEN}Just Spent CLI${NC}"
    echo "Usage: ./just-spent [command] [platform] [options]"
    echo ""
    echo "Commands:"
    echo "  test       Run unit tests"
    echo "  ui-test    Run UI tests"
    echo "  build      Build the project"
    echo "  ci         Run full CI pipeline (uses scripts/local-ci.sh)"
    echo "  diagnose   Run diagnostic tools"
    echo ""
    echo "Platforms:"
    echo "  android, ios"
    echo ""
    echo "Examples:"
    echo "  ./just-spent test android"
    echo "  ./just-spent ci"
    echo "  ./just-spent diagnose android"
}

COMMAND=$1
PLATFORM=$2
shift 2

if [ -z "$COMMAND" ]; then
    show_help
    exit 1
fi

case $COMMAND in
    test)
        if [ "$PLATFORM" == "android" ]; then
            echo -e "${YELLOW}Running Android Unit Tests...${NC}"
            ./scripts/android/test.sh unit "$@"
        elif [ "$PLATFORM" == "ios" ]; then
            echo -e "${YELLOW}Running iOS Unit Tests...${NC}"
            ./scripts/ios/test.sh unit "$@"
        else
            echo -e "${RED}Please specify platform: android or ios${NC}"
            exit 1
        fi
        ;;
    
    ui-test)
        if [ "$PLATFORM" == "android" ]; then
            echo -e "${YELLOW}Running Android UI Tests...${NC}"
            ./scripts/android/run_ui_tests.sh "$@"
        elif [ "$PLATFORM" == "ios" ]; then
            echo -e "${YELLOW}Running iOS UI Tests...${NC}"
            ./scripts/ios/test.sh ui "$@"
        else
            echo -e "${RED}Please specify platform: android or ios${NC}"
            exit 1
        fi
        ;;

    ci)
        echo -e "${YELLOW}Running Local CI Pipeline...${NC}"
        ./scripts/local-ci.sh "$@"
        ;;

    diagnose)
        if [ "$PLATFORM" == "android" ]; then
            ./scripts/android/diagnose-currency.sh "$@"
        else
            echo "No diagnostic script for $PLATFORM yet."
            exit 1
        fi
        ;;
        
    *)
        echo -e "${RED}Unknown command: $COMMAND${NC}"
        show_help
        exit 1
        ;;
esac
